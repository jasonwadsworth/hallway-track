type User {
  id: ID!
  email: AWSEmail!
  displayName: String!
  gravatarHash: String!
  contactLinks: [ContactLink!]!
  badges: [Badge!]!
  connectionCount: Int!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type ContactLink {
  id: ID!
  label: String!
  url: String!
  visible: Boolean!
}

type Connection {
  id: ID!
  userId: ID!
  connectedUserId: ID!
  connectedUser: User
  tags: [String!]!
  note: String
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
}

type Badge {
  id: ID!
  name: String!
  description: String!
  threshold: Int!
  iconUrl: String
  earnedAt: AWSDateTime
  category: String
  metadata: BadgeMetadata
}

type BadgeMetadata {
  relatedUserId: ID
  relatedUserName: String
  eventYear: Int
  count: Int
  triangleUsers: [ID!]
}

type LinkType {
  id: ID!
  label: String!
  imageUrl: String!
  placeholder: String!
  urlPattern: String
  sortOrder: Int!
}

type PublicProfile {
  id: ID!
  displayName: String!
  gravatarHash: String!
}

type ConnectedProfile {
  id: ID!
  displayName: String!
  gravatarHash: String!
  contactLinks: [ContactLink!]!
  badges: [Badge!]!
}

type RemoveConnectionResult {
  success: Boolean!
  message: String
}

enum ConnectionRequestStatus {
  PENDING
  APPROVED
  DENIED
  CANCELLED
}

type ConnectionRequest {
  id: ID!
  initiatorUserId: ID!
  recipientUserId: ID!
  initiator: PublicProfile
  recipient: PublicProfile
  status: ConnectionRequestStatus!
  createdAt: AWSDateTime!
  updatedAt: AWSDateTime!
  actionedAt: AWSDateTime
  initiatorNote: String
  initiatorTags: [String!]
}

type ConnectionRequestResult {
  success: Boolean!
  message: String
  request: ConnectionRequest
}

type ConnectionStatus {
  isConnected: Boolean!
  hasPendingRequest: Boolean!
  requestDirection: String
}

type Query {
  getUser(id: ID!): User
  getMyProfile: User
  getPublicProfile(userId: ID!): PublicProfile
  getConnectedProfile(userId: ID!): ConnectedProfile
  getMyConnections: [Connection!]!
  checkConnection(userId: ID!): Boolean!
  getLinkTypes: [LinkType!]!
  getIncomingConnectionRequests: [ConnectionRequest!]!
  getOutgoingConnectionRequests: [ConnectionRequest!]!
  checkConnectionOrRequest(userId: ID!): ConnectionStatus!
}

type Mutation {
  createUser(email: AWSEmail!, displayName: String!): User!
  updateDisplayName(displayName: String!): User!
  addContactLink(label: String!, url: String!, visible: Boolean): User!
  updateContactLink(contactLinkId: ID!, label: String, url: String, visible: Boolean): User!
  removeContactLink(contactLinkId: ID!): User!
  createConnection(connectedUserId: ID!): Connection!
  removeConnection(connectionId: ID!): RemoveConnectionResult!
  addTagToConnection(connectionId: ID!, tag: String!): Connection!
  removeTagFromConnection(connectionId: ID!, tag: String!): Connection!
  updateConnectionNote(connectionId: ID!, note: String): Connection!
  createConnectionRequest(recipientUserId: ID!, note: String, tags: [String!]): ConnectionRequestResult!
  approveConnectionRequest(requestId: ID!): ConnectionRequestResult!
  denyConnectionRequest(requestId: ID!): ConnectionRequestResult!
  cancelConnectionRequest(requestId: ID!): ConnectionRequestResult!
  updateConnectionRequestMetadata(requestId: ID!, note: String, tags: [String!]): ConnectionRequestResult!
}

schema {
  query: Query
  mutation: Mutation
}
